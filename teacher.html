<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trauma Room Trainer - Game Designer</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
            background: #1e1e1e;
            color: #cccccc;
            overflow: hidden;
            height: 100vh;
        }

        /* Main Layout - Game Engine Style */
        .app-layout {
            display: grid;
            grid-template-columns: 280px 1fr 350px;
            grid-template-rows: 50px 1fr 30px;
            height: 100vh;
            gap: 0;
        }

        /* Top Toolbar */
        .toolbar {
            grid-column: 1 / -1;
            background: #2d2d30;
            border-bottom: 1px solid #3e3e42;
            display: flex;
            align-items: center;
            padding: 0 15px;
            gap: 10px;
        }

        .toolbar-title {
            font-size: 14px;
            font-weight: 600;
            color: #ffffff;
            margin-right: auto;
        }

        .toolbar-btn {
            padding: 6px 14px;
            background: #0e639c;
            color: white;
            border: none;
            border-radius: 4px;
            font-size: 12px;
            cursor: pointer;
            transition: background 0.2s;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .toolbar-btn:hover {
            background: #1177bb;
        }

        .toolbar-btn.success {
            background: #0e7a0d;
        }

        .toolbar-btn.success:hover {
            background: #11910f;
        }

        .toolbar-btn.danger {
            background: #a1260d;
        }

        .toolbar-btn.danger:hover {
            background: #c42b1c;
        }

        /* Left Sidebar - Hierarchy */
        .hierarchy-panel {
            background: #252526;
            border-right: 1px solid #3e3e42;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .panel-header {
            padding: 10px 12px;
            background: #2d2d30;
            border-bottom: 1px solid #3e3e42;
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
            color: #999;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .panel-header-btn {
            background: transparent;
            border: none;
            color: #999;
            cursor: pointer;
            font-size: 16px;
            padding: 2px 6px;
            border-radius: 3px;
        }

        .panel-header-btn:hover {
            background: #3e3e42;
            color: #fff;
        }

        .hierarchy-search {
            padding: 8px;
            background: #1e1e1e;
            border-bottom: 1px solid #3e3e42;
        }

        .hierarchy-search input {
            width: 100%;
            padding: 6px 10px;
            background: #3c3c3c;
            border: 1px solid #3e3e42;
            border-radius: 4px;
            color: #cccccc;
            font-size: 12px;
        }

        .hierarchy-search input:focus {
            outline: none;
            border-color: #0e639c;
        }

        .hierarchy-tree {
            flex: 1;
            overflow-y: auto;
            padding: 8px 0;
        }

        .tree-category {
            margin-bottom: 4px;
        }

        .tree-category-header {
            padding: 6px 12px;
            cursor: pointer;
            user-select: none;
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 12px;
            color: #cccccc;
        }

        .tree-category-header:hover {
            background: #2a2d2e;
        }

        .tree-category-icon {
            font-size: 10px;
            transition: transform 0.2s;
        }

        .tree-category.collapsed .tree-category-icon {
            transform: rotate(-90deg);
        }

        .tree-category.collapsed .tree-category-items {
            display: none;
        }

        .tree-category-items {
            padding-left: 20px;
        }

        .tree-item {
            padding: 6px 12px;
            cursor: pointer;
            user-select: none;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 12px;
            color: #cccccc;
            border-left: 2px solid transparent;
        }

        .tree-item:hover {
            background: #2a2d2e;
        }

        .tree-item.selected {
            background: #094771;
            border-left-color: #0e639c;
            color: #ffffff;
        }

        .tree-item-icon {
            font-size: 14px;
        }

        .tree-item-name {
            flex: 1;
        }

        .tree-item-count {
            font-size: 10px;
            color: #999;
        }

        /* Center - Canvas Area */
        .canvas-panel {
            background: #1e1e1e;
            display: flex;
            flex-direction: column;
            position: relative;
        }

        .canvas-toolbar {
            background: #2d2d30;
            border-bottom: 1px solid #3e3e42;
            padding: 8px 12px;
            display: flex;
            gap: 12px;
            align-items: center;
        }

        .canvas-mode-btn {
            padding: 6px 12px;
            background: #3c3c3c;
            border: 1px solid #3e3e42;
            border-radius: 4px;
            color: #cccccc;
            font-size: 11px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .canvas-mode-btn:hover {
            background: #505050;
        }

        .canvas-mode-btn.active {
            background: #0e639c;
            border-color: #1177bb;
            color: white;
        }

        .canvas-controls {
            margin-left: auto;
            display: flex;
            gap: 8px;
            align-items: center;
        }

        .canvas-control-label {
            font-size: 11px;
            color: #999;
        }

        .canvas-control-input {
            width: 80px;
            padding: 4px 8px;
            background: #3c3c3c;
            border: 1px solid #3e3e42;
            border-radius: 3px;
            color: #cccccc;
            font-size: 11px;
        }

        .canvas-container {
            flex: 1;
            position: relative;
            overflow: hidden;
            background: #2d2d30;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        #room-canvas {
            cursor: crosshair;
            box-shadow: 0 0 20px rgba(0,0,0,0.5);
        }

        .canvas-info {
            position: absolute;
            bottom: 12px;
            left: 12px;
            background: rgba(0,0,0,0.7);
            padding: 6px 12px;
            border-radius: 4px;
            font-size: 11px;
            color: #cccccc;
            display: flex;
            gap: 15px;
        }

        /* Right Sidebar - Inspector */
        .inspector-panel {
            background: #252526;
            border-left: 1px solid #3e3e42;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .inspector-content {
            flex: 1;
            overflow-y: auto;
            padding: 15px;
        }

        .inspector-empty {
            display: flex;
            align-items: center;
            justify-content: center;
            height: 100%;
            color: #999;
            font-size: 12px;
            text-align: center;
        }

        .inspector-section {
            margin-bottom: 20px;
        }

        .inspector-section-title {
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
            color: #999;
            margin-bottom: 10px;
            padding-bottom: 6px;
            border-bottom: 1px solid #3e3e42;
        }

        .form-field {
            margin-bottom: 12px;
        }

        .form-field label {
            display: block;
            font-size: 11px;
            color: #cccccc;
            margin-bottom: 6px;
            font-weight: 500;
        }

        .form-field input[type="text"],
        .form-field input[type="number"],
        .form-field textarea,
        .form-field select {
            width: 100%;
            padding: 6px 10px;
            background: #3c3c3c;
            border: 1px solid #3e3e42;
            border-radius: 4px;
            color: #cccccc;
            font-size: 12px;
            font-family: inherit;
        }

        .form-field input:focus,
        .form-field textarea:focus,
        .form-field select:focus {
            outline: none;
            border-color: #0e639c;
        }

        .form-field textarea {
            resize: vertical;
            min-height: 80px;
        }

        .form-field-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }

        .color-picker-field {
            display: flex;
            gap: 8px;
            align-items: center;
        }

        .color-picker-field input[type="color"] {
            width: 40px;
            height: 32px;
            border: 1px solid #3e3e42;
            border-radius: 4px;
            cursor: pointer;
            background: #3c3c3c;
        }

        .color-picker-field input[type="text"] {
            flex: 1;
        }

        .checkbox-field {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 0;
        }

        .checkbox-field input[type="checkbox"] {
            width: 16px;
            height: 16px;
            cursor: pointer;
        }

        .checkbox-field label {
            margin: 0;
            cursor: pointer;
        }

        /* Item Multi-Select */
        .item-multiselect {
            background: #3c3c3c;
            border: 1px solid #3e3e42;
            border-radius: 4px;
            max-height: 250px;
            overflow-y: auto;
            padding: 8px;
        }

        .item-multiselect-item {
            padding: 8px 10px;
            margin-bottom: 4px;
            background: #2d2d30;
            border: 1px solid #3e3e42;
            border-radius: 3px;
            cursor: pointer;
            font-size: 11px;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .item-multiselect-item:hover {
            background: #3e3e42;
        }

        .item-multiselect-item.selected {
            background: #0e639c;
            border-color: #1177bb;
            color: white;
        }

        .item-multiselect-item::before {
            content: '‚òê';
            font-size: 14px;
        }

        .item-multiselect-item.selected::before {
            content: '‚òë';
        }

        .item-multiselect-empty {
            padding: 20px;
            text-align: center;
            color: #999;
            font-size: 11px;
        }

        /* Image Upload */
        .image-upload-field {
            position: relative;
        }

        .image-upload-preview {
            width: 100%;
            height: 150px;
            background: #3c3c3c;
            border: 2px dashed #3e3e42;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-top: 8px;
            cursor: pointer;
            transition: all 0.2s;
            overflow: hidden;
        }

        .image-upload-preview:hover {
            border-color: #0e639c;
            background: #454545;
        }

        .image-upload-preview.has-image {
            border-style: solid;
            padding: 0;
        }

        .image-upload-preview img {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
        }

        .image-upload-placeholder {
            color: #999;
            font-size: 11px;
            text-align: center;
        }

        /* Buttons */
        .btn {
            padding: 8px 16px;
            border: none;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            display: inline-flex;
            align-items: center;
            gap: 6px;
        }

        .btn-primary {
            background: #0e639c;
            color: white;
        }

        .btn-primary:hover {
            background: #1177bb;
        }

        .btn-success {
            background: #0e7a0d;
            color: white;
        }

        .btn-success:hover {
            background: #11910f;
        }

        .btn-danger {
            background: #a1260d;
            color: white;
        }

        .btn-danger:hover {
            background: #c42b1c;
        }

        .btn-secondary {
            background: #3c3c3c;
            color: #cccccc;
            border: 1px solid #3e3e42;
        }

        .btn-secondary:hover {
            background: #505050;
        }

        .btn-block {
            width: 100%;
            justify-content: center;
        }

        .btn-group {
            display: flex;
            gap: 8px;
            margin-top: 15px;
        }

        /* Bottom Status Bar */
        .status-bar {
            grid-column: 1 / -1;
            background: #007acc;
            color: white;
            padding: 0 15px;
            display: flex;
            align-items: center;
            gap: 20px;
            font-size: 11px;
        }

        .status-item {
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .status-item.success {
            color: #4ec9b0;
        }

        /* Scrollbar Styling */
        ::-webkit-scrollbar {
            width: 12px;
            height: 12px;
        }

        ::-webkit-scrollbar-track {
            background: #1e1e1e;
        }

        ::-webkit-scrollbar-thumb {
            background: #424242;
            border-radius: 6px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #4e4e4e;
        }

        /* Alert Toast */
        .alert-toast {
            position: fixed;
            top: 70px;
            right: 20px;
            background: #0e639c;
            color: white;
            padding: 12px 20px;
            border-radius: 4px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.5);
            z-index: 10000;
            display: none;
            animation: slideInRight 0.3s ease;
            font-size: 12px;
        }

        .alert-toast.show {
            display: block;
        }

        .alert-toast.success {
            background: #0e7a0d;
        }

        .alert-toast.error {
            background: #a1260d;
        }

        @keyframes slideInRight {
            from {
                transform: translateX(400px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.7);
            z-index: 9999;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: #252526;
            border: 1px solid #3e3e42;
            border-radius: 6px;
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            display: flex;
            flex-direction: column;
        }

        .modal-header {
            padding: 15px 20px;
            border-bottom: 1px solid #3e3e42;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-header h2 {
            font-size: 14px;
            color: #ffffff;
            font-weight: 600;
        }

        .modal-close {
            background: transparent;
            border: none;
            color: #999;
            font-size: 20px;
            cursor: pointer;
            padding: 0;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-close:hover {
            color: #fff;
        }

        .modal-body {
            padding: 20px;
            overflow-y: auto;
            flex: 1;
        }

        .modal-footer {
            padding: 15px 20px;
            border-top: 1px solid #3e3e42;
            display: flex;
            gap: 10px;
            justify-content: flex-end;
        }

        /* Canvas Selection Indicator */
        .cart-selection {
            position: absolute;
            border: 2px solid #0e639c;
            pointer-events: none;
            box-shadow: 0 0 0 2px rgba(14, 99, 156, 0.3);
        }

        /* Stats Grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin-bottom: 20px;
        }

        .stat-card {
            background: #3c3c3c;
            border: 1px solid #3e3e42;
            border-radius: 4px;
            padding: 12px;
            text-align: center;
        }

        .stat-card h3 {
            font-size: 24px;
            color: #0e639c;
            margin-bottom: 4px;
        }

        .stat-card p {
            font-size: 10px;
            color: #999;
            text-transform: uppercase;
        }
    </style>
</head>
<body>
    <div class="app-layout">
        <!-- Top Toolbar -->
        <div class="toolbar">
            <div class="toolbar-title">üéÆ Trauma Room Trainer - Game Designer</div>
            <button class="toolbar-btn success" onclick="saveAll()">üíæ Save All</button>
            <button class="toolbar-btn" onclick="exportConfiguration()">üì• Export</button>
            <button class="toolbar-btn" onclick="importConfiguration()">üì§ Import</button>
            <button class="toolbar-btn" onclick="previewGame()">‚ñ∂ Preview Game</button>
            <button class="toolbar-btn danger" onclick="resetToDefaults()">üîÑ Reset</button>
        </div>

        <!-- Left Sidebar - Hierarchy -->
        <div class="hierarchy-panel">
            <div class="panel-header">
                <span>Hierarchy</span>
                <button class="panel-header-btn" onclick="refreshHierarchy()">‚Üª</button>
            </div>
            <div class="hierarchy-search">
                <input type="text" placeholder="Search..." id="hierarchy-search" oninput="filterHierarchy()">
            </div>
            <div class="hierarchy-tree" id="hierarchy-tree">
                <!-- Tree will be populated by JS -->
            </div>
        </div>

        <!-- Center - Canvas -->
        <div class="canvas-panel">
            <div class="canvas-toolbar">
                <button class="canvas-mode-btn active" id="mode-room" onclick="setCanvasMode('room')">üè• Room Layout</button>
                <button class="canvas-mode-btn" id="mode-overview" onclick="setCanvasMode('overview')">üìä Overview</button>
                <div class="canvas-controls">
                    <label class="canvas-control-label">Room:</label>
                    <input type="number" id="room-width" class="canvas-control-input" value="800" min="400" max="1600" onchange="updateRoomSize()" style="width: 60px;">
                    <span class="canvas-control-label">√ó</span>
                    <input type="number" id="room-height" class="canvas-control-input" value="600" min="300" max="1200" onchange="updateRoomSize()" style="width: 60px;">
                    <span style="width: 1px; height: 20px; background: #3e3e42; margin: 0 8px;"></span>
                    <label class="canvas-control-label">Background:</label>
                    <input type="color" id="room-bg-color" class="canvas-control-input" value="#fafafa" onchange="updateRoomBackground()">
                    <span style="width: 1px; height: 20px; background: #3e3e42; margin: 0 8px;"></span>
                    <label class="canvas-control-label">Grid:</label>
                    <input type="checkbox" id="show-grid" onchange="drawCanvas()" checked>
                    <input type="number" id="grid-size" class="canvas-control-input" value="50" min="10" max="100" step="10" onchange="drawCanvas()" style="width: 50px;">
                    <label class="canvas-control-label">Snap:</label>
                    <input type="checkbox" id="snap-to-grid" onchange="updateSnapToGrid()">
                </div>
            </div>
            <div class="canvas-container">
                <canvas id="room-canvas" width="800" height="600"></canvas>
                <div id="three-container" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none;"></div>
                <div class="canvas-info">
                    <span id="canvas-info-mode">Mode: Room Layout</span>
                    <span id="canvas-info-selected">Selected: None</span>
                    <span id="canvas-info-mouse">X: 0, Y: 0</span>
                </div>
            </div>
        </div>

        <!-- Right Sidebar - Inspector -->
        <div class="inspector-panel">
            <div class="panel-header">
                <span>Inspector</span>
            </div>
            <div class="inspector-content" id="inspector-content">
                <div class="inspector-empty">
                    Select an item from the hierarchy<br>to view its properties
                </div>
            </div>
        </div>

        <!-- Bottom Status Bar -->
        <div class="status-bar">
            <div class="status-item">
                <span>üõí Carts: <strong id="status-carts">0</strong></span>
            </div>
            <div class="status-item">
                <span>üìã Scenarios: <strong id="status-scenarios">0</strong></span>
            </div>
            <div class="status-item">
                <span>üóÑÔ∏è Drawers: <strong id="status-drawers">0</strong></span>
            </div>
            <div class="status-item">
                <span>üì¶ Items: <strong id="status-items">0</strong></span>
            </div>
            <div class="status-item">
                <span>üèÜ Achievements: <strong id="status-achievements">0</strong></span>
            </div>
            <div class="status-item success" id="status-message">
                Ready
            </div>
        </div>
    </div>

    <!-- Alert Toast -->
    <div class="alert-toast" id="alert-toast"></div>

    <!-- Import Modal -->
    <div class="modal" id="import-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Import Configuration</h2>
                <button class="modal-close" onclick="closeModal('import-modal')">√ó</button>
            </div>
            <div class="modal-body">
                <div class="form-field">
                    <label>Select JSON Configuration File</label>
                    <input type="file" id="import-file" accept=".json">
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('import-modal')">Cancel</button>
                <button class="btn btn-primary" onclick="processImport()">Import</button>
            </div>
        </div>
    </div>

    <!-- Three.js Library -->
    <script src="https://cdn.jsdelivr.net/npm/three@0.160.0/build/three.min.js"></script>
    <!-- OrbitControls -->
    <script src="https://cdn.jsdelivr.net/npm/three@0.160.0/examples/js/controls/OrbitControls.js"></script>

    <script src="teacher.js"></script>
</body>
</html>
